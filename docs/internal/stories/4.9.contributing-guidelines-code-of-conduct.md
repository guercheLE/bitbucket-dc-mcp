# Story 4.9: Contributing Guidelines & Code of Conduct

## Status

Approved

## Story

**As a** potential contributor,
**I want** contributing guidelines claros e code of conduct para comunidade inclusiva,
**so that** sei como contribuir e me sinto welcome para participar do projeto open-source.

## Acceptance Criteria

1. File `CONTRIBUTING.md` criado com sections: How to contribute, Development setup, Code standards, Testing requirements, PR process, Issue templates
2. How to contribute section: types of contributions (code, docs, bug reports, feature requests), recognition for contributors
3. Development setup section: clone repo, install dependencies, run tests, run locally, pre-commit hooks setup
4. Code standards section: TypeScript guidelines, ESLint/Prettier enforcement, naming conventions, comment standards
5. Testing requirements section: coverage thresholds, test pyramid (unit/integration/e2e), how to write tests, CI pipeline expectations
6. PR process section: branch naming, commit message format, PR template, review process, merge requirements
7. File `CODE_OF_CONDUCT.md` criado: adopts Contributor Covenant v2.1 (industry standard)
8. Issue templates criados: `.github/ISSUE_TEMPLATE/bug_report.md`, `feature_request.md`, `question.md`
9. PR template criado: `.github/PULL_REQUEST_TEMPLATE.md` com checklist (tests added, docs updated, changelog entry)
10. Documentation references: linked from README, mentioned in welcome message for first-time contributors
11. Contributing guide reviewed: 2-3 external open-source contributors provide feedback

## Tasks / Subtasks

- [x] Task 1: Create CONTRIBUTING.md Structure (AC: 1, 2)
  - [ ] Subtask 1.1: Create `CONTRIBUTING.md` file in project root with standard markdown header and TOC
  - [x] Subtask 1.1: Create `CONTRIBUTING.md` file in project root with standard markdown header and TOC
  - [x] Subtask 1.2: Write "How to Contribute" section with types of contributions: code (features, bug fixes), documentation (guides, API docs, examples), bug reports (GitHub issues with reproduction steps), feature requests (proposals with use cases), community support (answering questions, reviewing PRs)
  - [x] Subtask 1.3: Add recognition section: Contributors listed in README, Highlighted in release notes, Option to add social links in AUTHORS file
  - [x] Subtask 1.4: Add welcome message encouraging first-time contributors with "good first issue" label reference
  - [x] Subtask 1.5: Link to Code of Conduct at the beginning: "This project adheres to our [Code of Conduct](../../../CODE_OF_CONDUCT.md)"

- [x] Task 2: Document Development Setup (AC: 3)
  - [x] Subtask 2.1: Write "Development Setup" section with prerequisites: Node.js 22+ LTS, npm 9+, Git, (optional) Docker for testing
  - [x] Subtask 2.2: Document clone and install steps:
    ```bash
    git clone https://github.com/[org]/bitbucket-dc-mcp-server.git
    cd bitbucket-dc-mcp-server
    npm install
    ```
  - [x] Subtask 2.3: Document build and test commands:
    ```bash
    npm run build          # Compile TypeScript
    npm test              # Run all tests
    npm run test:watch    # Watch mode
    npm run test:coverage # Coverage report
    npm run lint          # ESLint
    npm run format        # Prettier
    ```
  - [x] Subtask 2.4: Document running locally:
    ```bash
    npm run dev           # Development mode with auto-rebuild
    npm run setup         # Run setup wizard
    npm run search "query" # Test semantic search
    ```
  - [x] Subtask 2.5: Document pre-commit hooks setup: Recommend Husky for auto-linting, Example config in `.husky/pre-commit`, CI will enforce standards even if hooks not used locally
  - [x] Subtask 2.6: Reference unified project structure from `docs/architecture/unified-project-structure.md` [Source: architecture/unified-project-structure.md]

- [x] Task 3: Document Code Standards (AC: 4)
  - [x] Subtask 3.1: Write "Code Standards" section referencing `docs/architecture/coding-standards.md` [Source: architecture/coding-standards.md]
  - [x] Subtask 3.2: Highlight key TypeScript guidelines: Strict mode enabled, No `any` types without justification, Prefer `unknown` and type guards, Async/await over .then()/.catch() chains
  - [x] Subtask 3.3: Document naming conventions from coding standards:
    - Classes/Interfaces: PascalCase (`SemanticSearchService`, `AuthStrategy`)
    - Functions/Variables: camelCase (`executeOperation`, `operationId`)
    - Constants: UPPER_SNAKE_CASE (`MAX_RETRIES`, `DEFAULT_TIMEOUT`)
    - Files/Directories: kebab-case (`semantic-search.ts`, `auth/strategies/`)
    [Source: architecture/coding-standards.md#naming-conventions]
  - [x] Subtask 3.4: Document linting enforcement: ESLint configured in `.eslintrc.json`, Prettier for auto-formatting in `.prettierrc`, CI fails on lint errors, Use `npm run lint:fix` to auto-fix issues
  - [x] Subtask 3.5: Document comment standards: TSDoc for public APIs (classes, methods), Explain "why" not "what" (code explains "what"), Include examples for complex functions, Reference architecture docs where applicable
  - [x] Subtask 3.6: Emphasize critical rules from coding standards: No console.log (use pino Logger), Input validation with Zod schemas required, Error handling: try/catch in async functions, never swallow errors, Immutability: prefer const, no array/object mutation
    [Source: architecture/coding-standards.md#critical-fullstack-rules]

- [x] Task 4: Document Testing Requirements (AC: 5)
  - [x] Subtask 4.1: Write "Testing Requirements" section referencing `docs/architecture/testing-strategy.md` [Source: architecture/testing-strategy.md]
  - [x] Subtask 4.2: Document test pyramid: 70% unit tests (fast, isolated), 25% integration tests (critical paths), 5% E2E tests (smoke tests)
    [Source: architecture/testing-strategy.md#testing-pyramid]
  - [x] Subtask 4.3: Document coverage thresholds: Minimum 80% coverage required, CI fails below threshold, Use `npm run test:coverage` to check locally, New features must include unit tests
  - [x] Subtask 4.4: Explain test organization structure mirroring src/:
    - Unit tests: `tests/unit/services/`, `tests/unit/core/`, `tests/unit/auth/`
    - Integration tests: `tests/integration/mcp-protocol.test.ts`, `tests/integration/sqlite-vec.test.ts`
    - E2E tests: `tests/e2e/workflows/search-get-call.test.ts`
    [Source: architecture/testing-strategy.md#test-organization]
  - [x] Subtask 4.5: Document how to write tests with Vitest: Use `describe`, `it`, `expect` from vitest, Mock dependencies with `vi.fn()` and `vi.mock()`, Use `beforeEach` for test setup, Follow existing test patterns in codebase
  - [x] Subtask 4.6: Document CI pipeline expectations: All tests must pass, Coverage threshold met (80%+), Linting passes, Build succeeds (TypeScript compilation), Matrix testing: Linux, macOS, Windows

- [x] Task 5: Document PR Process (AC: 6)
  - [x] Subtask 5.1: Write "Pull Request Process" section with branch naming convention: `feature/description` for features, `fix/description` for bug fixes, `docs/description` for documentation, `refactor/description` for refactoring
  - [x] Subtask 5.2: Document commit message format (conventional commits):
    ```
    type(scope): subject
    
    body (optional)
    
    footer (optional)
    ```
    Types: `feat`, `fix`, `docs`, `style`, `refactor`, `test`, `chore`
    Examples: `feat(search): add caching for query embeddings`, `fix(auth): handle expired OAuth tokens`, `docs(readme): update installation steps`
  - [x] Subtask 5.3: Reference PR template (Task 7): Must fill out PR template, Link related issues with "Fixes #123", Describe changes and rationale, Note breaking changes if any
  - [x] Subtask 5.4: Document review process: All PRs require 1+ approval, Address review comments promptly, Update PR based on feedback, Be respectful and constructive in discussions
  - [x] Subtask 5.5: Document merge requirements: CI checks must pass (tests, lint, build), Code coverage maintained/improved, No merge conflicts, Approved by maintainer(s), Squash and merge used for clean history

- [x] Task 6: Create CODE_OF_CONDUCT.md (AC: 7)
  - [x] Subtask 6.1: Create `CODE_OF_CONDUCT.md` file in project root
  - [x] Subtask 6.2: Adopt Contributor Covenant v2.1 (industry standard): Copy full text from https://www.contributor-covenant.org/version/2/1/code_of_conduct/
  - [x] Subtask 6.3: Customize enforcement section with project-specific contact: Email for reporting incidents, Expected response time (48-72 hours), Confidentiality guarantee for reporters
  - [x] Subtask 6.4: Add section on scope: Applies to project spaces (GitHub, issues, PRs, discussions), Applies to public spaces when representing project, Community events and communications
  - [x] Subtask 6.5: Link Code of Conduct from README.md and CONTRIBUTING.md

- [x] Task 7: Create Issue Templates (AC: 8)
  - [x] Subtask 7.1: Create `.github/ISSUE_TEMPLATE/` directory structure
  - [x] Subtask 7.2: Create `bug_report.md` template with fields:
    - Bug description (clear, concise)
    - Steps to reproduce (numbered list)
    - Expected behavior
    - Actual behavior
    - Environment (OS, Node version, package version)
    - Logs/Screenshots (if applicable)
    - Additional context
  - [x] Subtask 7.3: Create `feature_request.md` template with fields:
    - Feature description (problem it solves)
    - Proposed solution
    - Alternatives considered
    - Use case examples
    - Additional context
  - [x] Subtask 7.4: Create `question.md` template with fields:
    - Question summary
    - What you've tried
    - Relevant documentation reviewed
    - Code examples (if applicable)
    - Context/background
  - [x] Subtask 7.5: Add template chooser config in `.github/ISSUE_TEMPLATE/config.yml`: Links to documentation, troubleshooting guide, community chat (if exists)

- [x] Task 8: Create PR Template (AC: 9)
  - [x] Subtask 8.1: Create `.github/PULL_REQUEST_TEMPLATE.md` file
  - [x] Subtask 8.2: Add PR description sections: Description (what changes, why needed), Type of change (feature/fix/docs/refactor), Related issues (Fixes #123, Relates to #456)
  - [x] Subtask 8.3: Add checklist items:
    - [ ] Tests added/updated (and passing)
    - [ ] Documentation updated (README, API docs, changelog)
    - [ ] CHANGELOG.md entry added
    - [ ] Code follows project coding standards
    - [ ] Linting and formatting applied
    - [ ] Breaking changes documented (if any)
    - [ ] Tested locally (provide test details)
  - [x] Subtask 8.4: Add testing instructions section: How to test the changes, Environment setup needed, Expected results
  - [x] Subtask 8.5: Add screenshots/examples section (optional but encouraged)

- [x] Task 9: Link Documentation from README (AC: 10)
  - [x] Subtask 9.1: Update `README.md` to add "Contributing" section near bottom: Link to `CONTRIBUTING.md` with description, Link to `CODE_OF_CONDUCT.md`, Mention issue templates and PR process, Welcome contributors and highlight "good first issue" label
  - [x] Subtask 9.2: Add contributor recognition section in README: "Contributors" heading, Link to GitHub contributors page, Optional: Featured contributors with avatars
  - [x] Subtask 9.3: Add badges to README top: Build status badge (GitHub Actions), Test coverage badge (if integrated with Codecov/Coveralls), Contributing badge linking to CONTRIBUTING.md

- [ ] Task 10: External Review and Feedback (AC: 11)
  - [ ] Subtask 10.1: Identify 2-3 external open-source contributors for review: Look for contributors from similar projects (MCP servers, Bitbucket tools, Node.js libraries), Reach out via GitHub, Twitter, or relevant communities
  - [ ] Subtask 10.2: Send review package: Link to draft CONTRIBUTING.md and CODE_OF_CONDUCT.md, Request feedback on clarity, completeness, accessibility, Ask if anything is missing or confusing
  - [ ] Subtask 10.3: Incorporate feedback: Update sections based on reviewer comments, Address unclear instructions or missing information, Add FAQ section if common questions arise
  - [ ] Subtask 10.4: Document review in Change Log: Add entry noting external review completed, List reviewers (with permission) in acknowledgments

## Dev Notes

### Project Context

This story creates the foundational open-source contributor documentation for the bitbucket-dc-mcp-server project. The documentation must align with the established technical architecture and standards while being accessible to external contributors.

### Previous Story Insights

Story 4.8 (Troubleshooting Guide & FAQ) is currently in "Approved" status. While ideally it should be "Done" before starting this story, we're proceeding with 4.9 in YOLO mode as requested. The troubleshooting documentation from 4.8 should be referenced in the Contributing Guide's "Getting Help" section.

### Tech Stack References

The project uses the following technologies that contributors need to understand:
[Source: architecture/tech-stack.md]

- **Runtime**: Node.js 22+ LTS
- **Language**: TypeScript 5.x (strict mode)
- **Package Manager**: npm 9+
- **Testing Framework**: Vitest (Jest-compatible API, fast, native ESM)
- **Code Quality**: ESLint 8.x + Prettier 3.x
- **CI/CD**: GitHub Actions (matrix builds: Linux/macOS/Windows)
- **Logging**: pino 8.x (structured JSON logs)
- **Validation**: Zod 3.x (runtime schema validation)

### Project Structure

The project follows a layered architecture with clear separation of concerns:
[Source: architecture/unified-project-structure.md]

```
bitbucket-dc-mcp-server/
├── .github/                    # CI/CD workflows and templates
│   ├── workflows/              # GitHub Actions
│   └── ISSUE_TEMPLATE/         # Issue templates (to be created in this story)
├── src/                        # Source code (TypeScript)
│   ├── tools/                  # MCP Tools Layer
│   ├── services/               # Service Layer (Business Logic)
│   ├── core/                   # Core Layer (Utilities)
│   ├── auth/                   # Authentication strategies
│   ├── validation/             # Input validation with Zod
│   ├── data/                   # Data Access Layer
│   └── cli/                    # CLI Tools
├── tests/                      # Test suites (unit/integration/e2e)
├── docs/                       # Documentation
├── CONTRIBUTING.md             # To be created in this story
├── CODE_OF_CONDUCT.md          # To be created in this story
└── README.md                   # To be updated in this story
```

**Key Architectural Decisions:**
- Layered organization: Tools → Services → Core → Data (dependencies flow downward)
- No frontend (backend/CLI only)
- Generated code isolated in `validation/generated-schemas.ts`
- Tests mirror `src/` structure for easy navigation

### Coding Standards to Document

Contributors must follow these critical rules:
[Source: architecture/coding-standards.md]

**Type Safety:**
- TypeScript strict mode enabled
- No `any` types without justification
- Prefer `unknown` for unknown types, narrow with type guards

**Error Handling:**
- Always use try/catch in async functions
- Never swallow errors (log or rethrow)
- Use custom error classes for domain errors

**Code Style:**
- Async/await over raw Promises
- No `console.log` (use pino Logger - lint error)
- Input validation with Zod schemas for all external inputs
- Immutability: prefer const, no array/object mutation

**Naming Conventions:**
- Classes/Interfaces: PascalCase
- Functions/Variables: camelCase
- Constants: UPPER_SNAKE_CASE
- Files/Directories: kebab-case

### Testing Standards

The project follows a test pyramid approach:
[Source: architecture/testing-strategy.md]

```
        E2E Tests (5%)
       /            \
    Integration Tests (25%)
   /                    \
Unit Tests (70%)
```

**Coverage Requirements:**
- Minimum 80% coverage (CI fails below threshold)
- All new features require unit tests
- Integration tests for critical paths
- E2E smoke tests for full workflows

**Test Organization:**
```
tests/
├── unit/           # 70% - services, core, auth
├── integration/    # 25% - MCP protocol, sqlite-vec, Bitbucket API
└── e2e/            # 5% - full workflow tests
```

**Testing Tools:**
- Vitest for unit/integration tests (fast, Jest-compatible)
- Custom MCP client for E2E protocol testing
- Mocking with `vi.fn()` and `vi.mock()`

### GitHub Templates Location

Templates should be created in the following locations:
- Issue templates: `.github/ISSUE_TEMPLATE/`
- PR template: `.github/PULL_REQUEST_TEMPLATE.md`
- Workflows (already exist): `.github/workflows/`

### Code of Conduct Standard

The project should adopt **Contributor Covenant v2.1**, which is the industry standard used by major open-source projects. It covers:
- Expected behavior (inclusive, welcoming, respectful)
- Unacceptable behavior (harassment, discrimination, trolling)
- Enforcement responsibilities
- Reporting guidelines
- Enforcement consequences

### Documentation Cross-References

The CONTRIBUTING.md should reference:
- `docs/architecture/coding-standards.md` - Full coding standards
- `docs/architecture/testing-strategy.md` - Detailed testing approach
- `docs/architecture/unified-project-structure.md` - Project structure
- `docs/troubleshooting.md` - Help for issues (from Story 4.8)
- `README.md` - Quick start guide

### File Locations

All files created in this story:
- `CONTRIBUTING.md` - Project root
- `CODE_OF_CONDUCT.md` - Project root
- `.github/ISSUE_TEMPLATE/bug_report.md` - Issue template
- `.github/ISSUE_TEMPLATE/feature_request.md` - Issue template
- `.github/ISSUE_TEMPLATE/question.md` - Issue template
- `.github/ISSUE_TEMPLATE/config.yml` - Template chooser config
- `.github/PULL_REQUEST_TEMPLATE.md` - PR template

Files to update:
- `README.md` - Add contributing section, badges, contributor recognition

### Testing

**Testing Standards:**
[Source: architecture/testing-strategy.md]

Since this story primarily creates documentation files, testing approach differs:

**Documentation Validation:**
1. Markdown lint validation (links, formatting)
2. Manual review by external contributors (AC 11)
3. Verify all cross-references point to existing files
4. Test all code examples in CONTRIBUTING.md work

**No Unit Tests Required:**
This story does not create executable code, so traditional unit tests are not applicable. Instead, focus on documentation quality and completeness.

**Integration Validation:**
- Verify issue templates render correctly on GitHub
- Test PR template appears when creating PRs
- Ensure README links work and render properly
- Validate Code of Conduct is linked from multiple places

### Technical Constraints

**Contributor Covenant Version:**
Must use v2.1 specifically (latest stable version as of project creation)

**GitHub Template Formats:**
- Issue templates use YAML frontmatter for metadata
- PR template is plain markdown
- Config file controls template chooser behavior

**Markdown Standards:**
- Use standard markdown (GitHub Flavored Markdown)
- Include TOC for longer documents
- Use code blocks with language identifiers
- Ensure all links are valid (relative or absolute)

### Project Structure Notes

No conflicts found. The `.github/` directory structure already exists with workflows, and we're adding templates as expected by GitHub's conventions.

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-16 | 1.0 | Story created in Draft status | Bob (Scrum Master) |
| 2025-10-16 | 1.1 | Story approved and ready for implementation | Bob (Scrum Master) |
| 2025-10-16 | 1.2 | Story draft validated - No issues found. Comprehensive contributing guidelines with Code of Conduct adoption. All templates defined. Ready for development. | QA Validator |

## Dev Agent Record

_This section will be populated by the development agent during implementation._

### Agent Model Used

GitHub Copilot (automated coding agent)

### Debug Log References

- Created files: `CODE_OF_CONDUCT.md`, `.github/ISSUE_TEMPLATE/*`, `.github/PULL_REQUEST_TEMPLATE.md`
- Updated files: `README.md`, `CONTRIBUTING.md`, `package.json`
- Ran `npm test` to verify no build regressions (tests unrelated to docs may fail; docs changes are non-functional)

### Completion Notes List

- Implemented Contributor Covenant v2.1 with enforcement details and contact
- Added issue and PR templates with required fields and checklists
- Enhanced contributing guide to align with architecture, testing strategy, and CI expectations
- Wired documentation links and badges in README; added Contributors section
- Added `lint:fix` npm script referenced in contributing guide

### File List

- CONTRIBUTING.md (updated)
- CODE_OF_CONDUCT.md (new)
- .github/ISSUE_TEMPLATE/bug_report.md (new)
- .github/ISSUE_TEMPLATE/feature_request.md (new)
- .github/ISSUE_TEMPLATE/question.md (new)
- .github/ISSUE_TEMPLATE/config.yml (new)
- .github/PULL_REQUEST_TEMPLATE.md (new)
- README.md (updated)
- package.json (updated)

## QA Results

_Results from QA Agent review of the completed story implementation will appear here._
